<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Brahmavidya</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- THEME --- */
        :root { --glass: rgba(20,20,20,0.95); --neon: #00f2ff; --gold: #ffd700; --pink: #ff0099; }
        body { margin:0; font-family:'Segoe UI', sans-serif; background:url('login_bg.png') center/cover fixed; color:white; height:100vh; overflow:hidden; -webkit-user-select:none; }
        
        .screen { display:none; height:100%; width:100%; flex-direction:column; }
        .active { display:flex; }
        
        .glass-panel { background:rgba(255,255,255,0.05); backdrop-filter:blur(15px); border:1px solid rgba(255,255,255,0.1); border-radius:15px; }
        input { background:rgba(0,0,0,0.5); border:1px solid var(--neon); color:white; padding:12px; border-radius:10px; width:100%; box-sizing:border-box; outline:none; }
        button { background:var(--neon); border:none; padding:12px; border-radius:10px; font-weight:bold; width:100%; cursor:pointer; margin-top:15px; }
        
        /* OVI SCREEN */
        #ovi-screen { justify-content:center; align-items:center; text-align:center; background:black; }
        .shloka-box { 
            border: 1px solid var(--gold); padding: 25px; border-radius: 15px; 
            color: var(--gold); font-size: 20px; line-height: 1.6; 
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2); margin: 20px; font-weight: bold;
        }

        /* DASHBOARD (TEXT LIST) */
        .navbar { height:60px; padding:0 15px; display:flex; justify-content:space-between; align-items:center; background:rgba(0,0,0,0.8); border-bottom: 1px solid #333; }
        .book-list-container { display: flex; flex-direction: column; gap: 10px; padding: 20px; overflow-y: auto; flex: 1; }
        
        .book-item { 
            display: flex; justify-content: space-between; align-items: center;
            padding: 18px 20px; 
            background: linear-gradient(90deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02)); 
            border-left: 4px solid var(--neon);
            border-radius: 8px; margin-bottom: 5px;
        }
        .book-item:active { background: rgba(0, 242, 255, 0.1); }
        .book-name { font-size: 18px; font-weight: 500; color: white; margin-left: 10px; }
        
        /* READER & CHAT */
        #reader-screen { background:#f4f4f4; color:#333; }
        .chat-area { flex:1; overflow-y:auto; padding:10px; background:rgba(0,0,0,0.3); margin:10px 0; border-radius:10px; display:flex; flex-direction:column; gap:8px; }
        .msg { padding:8px 12px; border-radius:10px; max-width:80%; font-size:14px; }
        .msg-u { align-self:flex-end; background:var(--neon); color:black; }
        .msg-a { align-self:flex-start; background:rgba(255,255,255,0.2); border:1px solid white; }
        .modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:2000; display:none; justify-content:center; align-items:center; }
    </style>
</head>
<body>

    <div id="login-screen" class="screen active" style="justify-content:center; align-items:center;">
        <div class="glass-panel" style="padding:40px; width:80%; max-width:350px; text-align:center;">
            <img src="logo.png" width="90" style="border-radius:50%; box-shadow:0 0 20px var(--neon); margin-bottom:20px;">
            <h3>Brahmavidya</h3>
            <input id="inp-name" placeholder="Enter Full Name" style="margin-bottom:10px;">
            <p style="color:gray; font-size:12px;">Auto Device ID</p>
            <button onclick="login()">LOGIN</button>
        </div>
    </div>

    <div id="ovi-screen" class="screen">
        <div style="padding:30px; width:90%; max-width:500px;">
            <i class="fas fa-book-reader" style="font-size:50px; color:var(--pink); margin-bottom:20px;"></i>
            <h3 style="color:white; margin-bottom:5px;">Digital Granthalaya</h3>
            <div class="shloka-box">
                "‡§∂‡•ç‡§∞‡•Ä‡§ï‡•É‡§∑‡•ç‡§£‡§∞‡§æ‡§µ‡•ã ‡§Æ‡•ç‡§π‡§£‡•á ‡§â‡§¶‡•ç‡§ß‡§µ‡§¶‡•á‡§µ‡§æ :<br>‡§π‡§æ ‡§ú‡•ç‡§û‡§æ‡§®‡§∞‡§§‡•ç‡§®‡§æ‡§ö‡§æ ‡§†‡•á‡§µ‡§æ :<br>‡§≠‡§≤‡•á‡§§‡§Ø‡§æ ‡§π‡§æ‡§§‡•Ä‡§Ç ‡§®‡•á‡§¶‡§æ‡§µ‡§æ :<br>‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞‡•á‡§Ç‡§µ‡•Ä‡§£ ‡•§‡•§"
            </div>
            <p style="color:gray; font-size:12px;">Waiting for Admin Permission...</p>
            <button onclick="checkAccess()" style="background:transparent; border:1px solid var(--neon); color:var(--neon); width:auto; padding:10px 30px;">Refresh Status</button>
            <p id="debug-id" style="font-size:10px; color:#333; margin-top:20px;"></p>
        </div>
    </div>

    <div id="dashboard-screen" class="screen">
        <div class="navbar">
            <i class="fas fa-user-circle" style="font-size:24px; color:var(--neon);" onclick="openSet('profile')"></i>
            <span style="font-weight:bold;">BRAHMAVIDYA</span>
            <i class="fas fa-bars" style="font-size:24px;" onclick="openSet('menu')"></i>
        </div>
        <div class="book-list-container" id="book-list"></div>
    </div>

    <div id="reader-screen" class="screen">
        <div style="height:50px; background:white; display:flex; align-items:center; padding:0 15px; justify-content:space-between;">
            <i class="fas fa-arrow-left" onclick="showScreen('dashboard-screen')" style="color:black;"></i>
            <span id="book-title" style="color:black; font-weight:bold;">Title</span>
            <i class="fas fa-bookmark" style="color:var(--neon);"></i>
        </div>
        <div id="book-content" style="padding:20px; flex:1; overflow-y:auto; font-size:18px; line-height:1.6; text-align:justify; -webkit-user-select:text;"></div>
        <div style="height:50px; background:white; display:flex; align-items:center; padding:0 10px; border-top:1px solid #ccc;">
            <input id="search-input" placeholder="Search..." style="background:#eee; color:black; border:none;" onkeyup="window.find(this.value)">
        </div>
    </div>

    <div id="settings-modal" class="modal">
        <div class="glass-panel modal-content" style="width:90%; max-height:90%; padding:20px; display:flex; flex-direction:column;">
            <div id="modal-body" style="flex:1; overflow-y:auto; margin-top:10px;"></div>
        </div>
    </div>

    <script src="filelist.js"></script>
    <script>
        const DB_URL = "https://adx-bk-default-rtdb.asia-southeast1.firebasedatabase.app";
        let user = { uid: localStorage.getItem('bv_uid'), name: localStorage.getItem('bv_name') };
        let bookPermissions = {}; 

        window.onload = () => {
            if(user.uid) { 
                document.getElementById('debug-id').innerText = user.uid;
                checkAccess(); setInterval(checkAccess, 5000); 
            }
        };

        function getDeviceId() {
            let id = localStorage.getItem('bv_device_id');
            if(!id) {
                id = (navigator.platform.substring(0,3)||"Mob") + "_" + Math.floor(Math.random()*10000);
                localStorage.setItem('bv_device_id', id);
            }
            return id;
        }

        function login() {
            const n = document.getElementById('inp-name').value.trim();
            if(!n) return alert("Enter Name");
            const d = getDeviceId();
            const uid = (n + "_" + d).replace(/[^a-zA-Z0-9]/g, "");
            user = { uid, name: n };
            localStorage.setItem('bv_uid', uid); localStorage.setItem('bv_name', n);

            fetch(`${DB_URL}/users/${uid}.json`).then(r=>r.json()).then(exist => {
                const data = { name: n, device: d, lastLogin: Date.now(), isOnline:true, granted: (exist && exist.granted) ? true : false };
                fetch(`${DB_URL}/users/${uid}.json`, { method:'PUT', body:JSON.stringify(data) }).then(() => checkAccess());
            });
            
            // Auto Sync Books
            if(typeof autoBookList !== 'undefined') {
                 const updates = {}; autoBookList.forEach(b => updates[b.name]=true);
                 fetch(`${DB_URL}/library_catalog.json`, {method:'PATCH', body:JSON.stringify(updates)});
            }
        }

        function checkAccess() {
            if(!user.uid) return showScreen('login-screen');
            Promise.all([
                fetch(`${DB_URL}/users/${user.uid}.json?t=${Date.now()}`).then(r=>r.json()),
                fetch(`${DB_URL}/users/${user.uid}/access.json?t=${Date.now()}`).then(r=>r.json())
            ]).then(([u, perms]) => {
                bookPermissions = perms || {};
                let allowedCount = 0;
                if(bookPermissions) Object.values(bookPermissions).forEach(val => { if(val === true) allowedCount++; });

                if(u && u.granted === true && !u.isBlocked && allowedCount > 0) {
                    if(!document.getElementById('dashboard-screen').classList.contains('active') && !document.getElementById('reader-screen').classList.contains('active')) {
                        loadDashboard();
                    } else if(document.getElementById('dashboard-screen').classList.contains('active')) {
                        renderBooks();
                    }
                } else { showScreen('ovi-screen'); }
            });
        }

        function loadDashboard() { showScreen('dashboard-screen'); renderBooks(); }
        
        function renderBooks() {
            const list = document.getElementById('book-list'); list.innerHTML="";
            let books = (typeof autoBookList !== 'undefined') ? autoBookList : [];
            let visibleCount = 0;

            books.forEach(b => {
                if(bookPermissions[b.name] === true) { // SHOW ONLY ALLOWED
                    visibleCount++;
                    list.innerHTML += `
                    <div class="book-item" onclick="openBook('${b.name}','${b.file}')">
                        <div style="display:flex; align-items:center;">
                            <i class="fas fa-book" style="color:var(--neon)"></i>
                            <span class="book-name">${b.name}</span>
                        </div>
                        <i class="fas fa-chevron-right" style="color:gray; font-size:12px;"></i>
                    </div>`;
                }
            });
            if(visibleCount === 0) showScreen('ovi-screen');
        }

        function openBook(n,f) {
            showScreen('reader-screen'); document.getElementById('book-title').innerText=n;
            fetch(f).then(r=>r.text()).then(t => {
                const d=document.getElementById('book-content'); d.innerHTML=t;
                d.scrollTop=localStorage.getItem('pos_'+n)||0; d.onscroll=()=>localStorage.setItem('pos_'+n, d.scrollTop);
            });
        }

        function openSet(t) {
            document.getElementById('settings-modal').style.display='flex';
            const b = document.getElementById('modal-body');
            
            if(t==='menu') {
                b.innerHTML=`<h2 style="text-align:center;">MENU</h2>
                <div onclick="openSet('profile')" style="padding:15px; border-bottom:1px solid #333;">üë§ Profile</div>
                <div onclick="openSet('about')" style="padding:15px; border-bottom:1px solid #333;">‚ÑπÔ∏è About Us</div>
                <div onclick="openSet('chat')" style="padding:15px;">üí¨ Chat</div>
                <button onclick="document.getElementById('settings-modal').style.display='none'" style="margin-top:20px; background:#333;">Close</button>`;
            } 
            else if(t==='about') {
                // üî• FULL MARATHI INFO WITH IMAGES üî•
                b.innerHTML=`
                    <button onclick="openSet('menu')">Back</button>
                    <div style="margin-top:15px; text-align:justify; line-height:1.6; color:#ddd;">
                        <img src="photo1.jpg" style="width:100%; border-radius:10px; margin-bottom:10px;">
                        <h3 style="color:var(--gold); text-align:center;">‡•• ‡§∂‡•ç‡§∞‡•Ä ‡§¶‡§§‡•ç‡§§‡§æ‡§§‡•ç‡§∞‡•á‡§Ø ‡§™‡•ç‡§∞‡§≠‡•Ç ‡§≠‡§ó‡§µ‡§æ‡§® ‡§ï‡•Ä ‡§ú‡§Ø ‡••</h3>
                        <p>
                            "‡§ú‡•ç‡§Ø‡§æ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡•á ‡§Ü‡§ï‡§æ‡§∂‡§æ‡§§ ‡§∏‡•Ç‡§∞‡•ç‡§Ø ‡§§‡§≥‡§™‡§§ ‡§Ö‡§∏‡§§‡•ã ‡§Ü‡§£‡§ø ‡§§‡•ç‡§Ø‡§æ‡§ö‡•ç‡§Ø‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∂‡§æ‡§®‡•á ‡§∏‡§Ç‡§™‡•Ç‡§∞‡•ç‡§£ ‡§µ‡§ø‡§∂‡•ç‡§µ ‡§â‡§ú‡§≥‡•Ç‡§® ‡§®‡§ø‡§ò‡§§‡•á, ‡§§‡•ç‡§Ø‡§æ‡§ö‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡•á ‡§Ü‡§™‡§≤‡•ç‡§Ø‡§æ ‡§∏‡§æ‡§ß‡§ï‡§æ‡§Ç‡§ö‡•ç‡§Ø‡§æ ‡§Ü‡§Ø‡•Å‡§∑‡•ç‡§Ø‡§æ‡§§‡•Ä‡§≤ ‡§Ö‡§ú‡•ç‡§û‡§æ‡§®‡§æ‡§ö‡§æ ‡§Ö‡§Ç‡§ß‡§ï‡§æ‡§∞ ‡§¶‡•Ç‡§∞ ‡§ï‡§∞‡•Ç‡§® ‡§§‡•ç‡§Ø‡§æ‡§Ç‡§®‡§æ '‡§¨‡•ç‡§∞‡§π‡•ç‡§Æ‡§µ‡§ø‡§¶‡•ç‡§Ø‡•á‡§ö‡§æ' ‡§≤‡§ñ‡•ç‡§ñ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∂ ‡§¶‡•á‡§£‡§æ‡§∞‡•á ‡§∏‡§æ‡§ï‡•ç‡§∑‡§æ‡§§ '‡§™‡•ç‡§∞‡§ú‡•ç‡§û‡§æ‡§∏‡•Ç‡§∞‡•ç‡§Ø' ‡§Æ‡•ç‡§π‡§£‡§ú‡•á ‡§™. ‡§™‡•Ç. ‡§™. ‡§Æ. ‡§∂‡•ç‡§∞‡•Ä ‡§Æ‡•ã‡§†‡•á ‡§¨‡§æ‡§¨‡§æ ‡§Ö‡§Ç‡§ï‡•Å‡§≥‡§®‡•á‡§∞‡§ï‡§∞ ‡§π‡•ã‡§§."
                        </p>
                        <p>
                            ‡§Ø‡§æ ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§§ ‡§∏‡•Ç‡§∞‡•ç‡§Ø‡§æ‡§ö‡•á ‡§∏‡•ç‡§•‡§æ‡§® ‡§Ö‡§¢‡§≥ ‡§Ü‡§π‡•á, ‡§∏‡•Ç‡§∞‡•ç‡§Ø ‡§ï‡§ß‡•Ä‡§π‡•Ä ‡§Æ‡§æ‡§µ‡§≥‡§§ ‡§®‡§æ‡§π‡•Ä, ‡§§‡•ã ‡§´‡§ï‡•ç‡§§ ‡§Ü‡§™‡§≤‡•Ä ‡§ú‡§æ‡§ó‡§æ ‡§¨‡§¶‡§≤‡§§‡•ã. ‡§Ö‡§ó‡§¶‡•Ä ‡§§‡•ç‡§Ø‡§æ‡§ö‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡•á, ‡§™. ‡§™‡•Ç. ‡§∂‡•ç‡§∞‡•Ä ‡§Æ‡•ã‡§†‡•á‡§¨‡§æ‡§¨‡§æ‡§Ç‡§ö‡•á ‡§Ö‡§∏‡•ç‡§§‡§ø‡§§‡•ç‡§µ ‡§Ü‡§£‡§ø ‡§§‡•ç‡§Ø‡§æ‡§Ç‡§ö‡•á ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§Ü‡§ú‡§π‡•Ä ‡§Ö‡§ñ‡§Ç‡§° ‡§Ü‡§£‡§ø ‡§Ö‡§µ‡§ø‡§∞‡§§ ‡§∏‡•Å‡§∞‡•Ç ‡§Ü‡§π‡•á. ‡§§‡•á ‡§Ü‡§ú‡§π‡•Ä ‡§Ü‡§™‡§≤‡•ç‡§Ø‡§æ ‡§∂‡§ø‡§∑‡•ç‡§Ø‡§µ‡•É‡§Ç‡§¶‡§æ‡§Ç‡§ö‡•ç‡§Ø‡§æ, ‡§∏‡§æ‡§ß‡§ï‡§æ‡§Ç‡§ö‡•ç‡§Ø‡§æ ‡§™‡§æ‡§†‡•Ä‡§∂‡•Ä ‡§ñ‡§Ç‡§¨‡•Ä‡§∞‡§™‡§£‡•á ‡§â‡§≠‡•á ‡§Ü‡§π‡•á‡§§.
                        </p>
                        <p>
                            ‡§∂‡§æ‡§∏‡•ç‡§§‡•ç‡§∞‡§æ‡§Ç‡§Æ‡§ß‡•ç‡§Ø‡•á '‡§∏‡§∞‡•ç‡§µ‡§µ‡§ø‡§¶‡•ç' ‡§Ü‡§£‡§ø '‡§¨‡•ç‡§∞‡§π‡•ç‡§Æ‡§®‡§ø‡§∑‡•ç‡§†' ‡§Ö‡§∂‡§æ ‡§Æ‡§π‡§æ‡§™‡•Å‡§∞‡•Å‡§∑‡§æ‡§Ç‡§ö‡•á ‡§µ‡§∞‡•ç‡§£‡§® ‡§Ü‡§¢‡§≥‡§§‡•á. ‡§∂‡•ç‡§∞‡•Ä‡§Æ‡•ã‡§†‡•á‡§¨‡§æ‡§¨‡§æ ‡§π‡•á ‡§Ø‡§æ ‡§µ‡§∞‡•ç‡§£‡§®‡§æ‡§ö‡•á ‡§Æ‡•Ç‡§∞‡•ç‡§§‡§ø‡§Æ‡§Ç‡§§ ‡§∞‡•Ç‡§™ ‡§Ü‡§π‡•á‡§§. ‡§ó‡•Ä‡§§‡•á‡§§‡•Ä‡§≤ '‡§ú‡•ç‡§û‡§æ‡§®‡§ø‡§Ø‡§æ‡§ö‡•Ä ‡§≤‡§ï‡•ç‡§∑‡§£‡•á' - ‡§Ö‡§Æ‡§æ‡§®‡§ø‡§§‡•ç‡§µ, ‡§Ö‡§¶‡§Ç‡§≠‡§ø‡§§‡•ç‡§µ, ‡§∂‡§æ‡§Ç‡§§‡•Ä, ‡§µ‡•à‡§∞‡§æ‡§ó‡•ç‡§Ø - ‡§π‡•Ä ‡§∏‡§∞‡•ç‡§µ ‡§§‡•ç‡§Ø‡§æ‡§Ç‡§ö‡•ç‡§Ø‡§æ ‡§†‡§æ‡§Ø‡•Ä ‡§Ö‡§®‡•Å‡§≠‡§µ‡§æ‡§∏ ‡§Ø‡•á‡§§‡§æ‡§§.
                        </p>
                        <hr style="border-color:#444;">
                        <h4 style="color:var(--neon); text-align:center;">‡•• ‡§¨‡•ç‡§∞‡§π‡•ç‡§Æ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ - ‡§∏‡•ç‡§µ‡§æ‡§ß‡•ç‡§Ø‡§æ‡§Ø ‡§Ü‡§£‡§ø ‡§ö‡§ø‡§Ç‡§§‡§® ‡••</h4>
                        <p>
                            ‡§™. ‡§™‡•Ç. ‡§∂‡•ç‡§∞‡•Ä ‡§Æ‡•ã‡§†‡•á ‡§¨‡§æ‡§¨‡§æ‡§Ç‡§®‡•Ä ‡§ú‡•Ä '‡§¨‡•ç‡§∞‡§π‡•ç‡§Æ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ' ‡§¶‡§ø‡§≤‡•Ä ‡§Ü‡§π‡•á, ‡§§‡§ø‡§ö‡•á ‡§∞‡§ï‡•ç‡§∑‡§£ ‡§ï‡§∞‡§£‡•á ‡§π‡•á ‡§Ü‡§™‡§≤‡•á ‡§ï‡§∞‡•ç‡§§‡§µ‡•ç‡§Ø ‡§Ü‡§π‡•á. ‡§π‡•á ‡•≤‡§™ ‡§Æ‡•ç‡§π‡§£‡§ú‡•á ‡§∏‡§æ‡§ß‡§ï‡§æ‡§Ç‡§∏‡§æ‡§†‡•Ä ‡§è‡§ï <b>'‡§´‡§ø‡§∞‡§§‡•á ‡§ó‡•ç‡§∞‡§Ç‡§•‡§æ‡§≤‡§Ø' (Digital Library)</b> ‡§Ü‡§π‡•á.
                        </p>
                        <ul style="background:rgba(255,255,255,0.05); padding:15px; border-radius:10px;">
                            <li><b>‡•ß. ‡§Ö‡§ñ‡§Ç‡§° ‡§∏‡•ç‡§µ‡§æ‡§ß‡•ç‡§Ø‡§æ‡§Ø:</b> ‡§™‡•ç‡§∞‡§µ‡§æ‡§∏‡§æ‡§§‡§π‡•Ä ‡§µ‡§æ‡§ö‡§® ‡§∏‡•Å‡§∞‡•Ç ‡§∞‡§æ‡§π‡§æ‡§µ‡•á.</li>
                            <li><b>‡•®. ‡§ó‡•ç‡§∞‡§Ç‡§• ‡§∞‡§ï‡•ç‡§∑‡§£:</b> ‡§¶‡•Å‡§∞‡•ç‡§Æ‡§ø‡§≥ ‡§™‡•ã‡§•‡•ç‡§Ø‡§æ ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§∞‡•Ç‡§™‡§æ‡§§ ‡§ú‡§™‡§£‡•á.</li>
                            <li><b>‡•©. ‡§¨‡§æ‡§¨‡§æ‡§Ç‡§ö‡•á ‡§µ‡§ø‡§ö‡§æ‡§∞:</b> ‡§®‡§ø‡§§‡•ç‡§Ø‡§®‡§ø‡§Ø‡§Æ ‡§Ü‡§£‡§ø ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§¶‡§∞‡•ç‡§∂‡§®‡§æ‡§∏‡§æ‡§†‡•Ä.</li>
                            <li><b>‡•™. SINCE:</b> 2 JANUARY 2026 </li>
                        </ul>
                        <p style="text-align:center; color:var(--gold); margin-top:20px;">‡•• ‡§∂‡•ç‡§∞‡•Ä‡§¶‡§§‡•ç‡§§‡§æ‡§§‡•ç‡§∞‡•á‡§Ø‡§™‡•ç‡§∞‡§≠‡•Ç ‡§Æ‡§π‡§æ‡§∞‡§æ‡§ú ‡§ï‡•Ä ‡§ú‡§Ø ‡••</p>
                        <img src="photo2.jpg" style="width:100%; border-radius:10px; margin-top:10px;">
                    </div>`;
            } 
            else if(t==='profile') {
                b.innerHTML=`<button onclick="openSet('menu')">Back</button><div style="text-align:center; margin-top:30px;"><h3>${user.name}</h3><p style="color:gray;">ID: ${localStorage.getItem('bv_device_id')}</p><p style="color:green;">Active</p></div>`;
            } 
            else if(t==='chat') { 
                b.innerHTML=`<button onclick="openSet('menu')">Back</button><div id="msgs" class="chat-area">Loading...</div><div style="display:flex;"><input id="c-in" style="flex:1;"><button onclick="snd()">Send</button></div>`; loadChat(); 
            }
        }
        
        function loadChat() { fetch(`${DB_URL}/feedback/${user.uid}.json`).then(r=>r.json()).then(d=>{ const m=document.getElementById('msgs'); if(!m)return; m.innerHTML=""; if(d) Object.values(d).forEach(x=>m.innerHTML+=`<div class="msg ${x.sender==='admin'?'msg-a':'msg-u'}">${x.text}</div>`); }); }
        function snd() { const t=document.getElementById('c-in').value; if(!t)return; fetch(`${DB_URL}/feedback/${user.uid}.json`, {method:'POST', body:JSON.stringify({text:t, sender:'user', timestamp:Date.now()})}).then(()=>{document.getElementById('c-in').value=""; loadChat();}); }
        function showScreen(id) { document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
    </script>
</body>
</html>
